From e851890d08e8b98fc1efc1c28b96244546a63e0c Mon Sep 17 00:00:00 2001
From: Connor McAdams <cmcadams@codeweavers.com>
Date: Fri, 19 Sep 2025 10:52:08 -0400
Subject: [PATCH] d3dx10: Add support for the format field in
 D3DX10_IMAGE_LOAD_INFO.

Signed-off-by: Connor McAdams <cmcadams@codeweavers.com>
---
 dlls/d3dx10_43/texture.c | 9 ++++-----
 1 file changed, 4 insertions(+), 5 deletions(-)

diff --git a/dlls/d3dx10_43/texture.c b/dlls/d3dx10_43/texture.c
index 3348911cdff..302efeccac1 100644
--- a/dlls/d3dx10_43/texture.c
+++ b/dlls/d3dx10_43/texture.c
@@ -656,8 +656,6 @@ HRESULT load_texture_data(const void *data, SIZE_T size, D3DX10_IMAGE_LOAD_INFO
         FIXME("load_info->CpuAccessFlags is ignored.\n");
     if (load_info->MiscFlags != D3DX10_DEFAULT)
         FIXME("load_info->MiscFlags is ignored.\n");
-    if (load_info->Format != D3DX10_DEFAULT)
-        FIXME("load_info->Format is ignored.\n");
 
     *resource_data = NULL;
     if (!load_info->Filter || load_info->Filter == D3DX10_DEFAULT)
@@ -688,10 +686,12 @@ HRESULT load_texture_data(const void *data, SIZE_T size, D3DX10_IMAGE_LOAD_INFO
         goto end;
     }
 
-    fmt_desc = get_d3dx_pixel_format_info(d3dx_pixel_format_id_from_dxgi_format(img_info.Format));
+    if (load_info->Format == D3DX10_DEFAULT || load_info->Format == DXGI_FORMAT_FROM_FILE)
+        load_info->Format = img_info.Format;
+    fmt_desc = get_d3dx_pixel_format_info(d3dx_pixel_format_id_from_dxgi_format(load_info->Format));
     if (fmt_desc->format == D3DX_PIXEL_FORMAT_COUNT)
     {
-        FIXME("Unknown DXGI format supplied, %#x.\n", img_info.Format);
+        FIXME("Unknown DXGI format supplied, %#x.\n", load_info->Format);
         hr = E_NOTIMPL;
         goto end;
     }
@@ -715,7 +715,6 @@ HRESULT load_texture_data(const void *data, SIZE_T size, D3DX10_IMAGE_LOAD_INFO
     if (!load_info->MipLevels || load_info->MipLevels == D3DX10_DEFAULT || load_info->MipLevels == D3DX10_FROM_FILE)
         load_info->MipLevels = (load_info->MipLevels == D3DX10_FROM_FILE) ? img_info.MipLevels : max_mip_levels;
     load_info->MipLevels = min(max_mip_levels, load_info->MipLevels);
-    load_info->Format = img_info.Format;
 
     hr = d3dx_create_subresource_data_for_texture(load_info->Width, load_info->Height, load_info->Depth,
             load_info->MipLevels, img_info.ArraySize, fmt_desc, &sub_rsrcs);
-- 
2.51.0

